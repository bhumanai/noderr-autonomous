[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:init-claude]
command=/app/init-claude.sh
autostart=true
autorestart=false
startsecs=0
stderr_logfile=/var/log/supervisor/init-claude.err.log
stdout_logfile=/var/log/supervisor/init-claude.out.log
priority=1

[program:tmux-claude]
command=/app/start.sh
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/tmux-claude.err.log
stdout_logfile=/var/log/supervisor/tmux-claude.out.log
environment=HOME="/root",USER="root"
priority=2

[program:inject-agent]
command=gunicorn -b 0.0.0.0:8080 --workers 2 --threads 4 --timeout 120 inject_agent:app
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/inject-agent.err.log
stdout_logfile=/var/log/supervisor/inject-agent.out.log
environment=PYTHONUNBUFFERED="1"
priority=3

[program:health-server]
command=python3 -m http.server 8081 --directory /app
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/health.err.log
stdout_logfile=/var/log/supervisor/health.out.log
priority=4

[program:completion-monitor]
command=python3 /app/completion_monitor.py
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/completion-monitor.err.log
stdout_logfile=/var/log/supervisor/completion-monitor.out.log
environment=CF_WORKER_URL="https://noderr-orchestrator.bhumanai.workers.dev",SESSION_NAME="claude-code",CHECK_INTERVAL="10"
priority=5

[group:claude-system]
programs=init-claude,tmux-claude,inject-agent,health-server,completion-monitor