<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Noderr Fleet Command - Manage your autonomous development agents">
    
    <title>Noderr Fleet Command</title>
    
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
    <script src="deploy-config.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="project-selector">
                <select id="projectSelect" class="project-dropdown">
                    <option value="">Select Project...</option>
                </select>
                <button id="addProjectBtn" class="btn-icon" aria-label="Add Project">+</button>
            </div>
            <div class="header-tabs">
                <button class="tab-btn active" data-tab="kanban">üìã Tasks</button>
                <button class="tab-btn" data-tab="brainstorm">üß† Brainstorm</button>
            </div>
            <div class="header-actions">
                <span id="connectionStatus" class="status-indicator"></span>
                <button id="settingsBtn" class="btn-icon" aria-label="Settings">‚öôÔ∏è</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Brainstorm View -->
        <div id="brainstormView" class="view-container" style="display: none;">
            <div class="brainstorm-container">
                <div class="brainstorm-sidebar">
                    <div class="brainstorm-sessions">
                        <div class="sessions-header">
                            <h3>Sessions</h3>
                            <button id="newSessionBtn" class="btn-icon">+</button>
                        </div>
                        <div id="sessionsList" class="sessions-list">
                            <!-- Sessions will be loaded here -->
                        </div>
                    </div>
                    <div class="brainstorm-context">
                        <h3>Context Gathered</h3>
                        <div id="contextPanel" class="context-panel">
                            <div class="context-section">
                                <h4>üìÅ Codebase Insights</h4>
                                <ul id="codebaseInsights"></ul>
                            </div>
                            <div class="context-section">
                                <h4>üîç Research Findings</h4>
                                <ul id="researchFindings"></ul>
                            </div>
                            <div class="context-section">
                                <h4>‚ö†Ô∏è Considerations</h4>
                                <ul id="considerations"></ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="brainstorm-main">
                    <div class="brainstorm-chat">
                        <div id="chatMessages" class="chat-messages">
                            <div class="chat-message ai">
                                <div class="message-content">
                                    <strong>üß† Brainstorm AI</strong>
                                    <p>Hi! Let's brainstorm your idea. Tell me what you want to build, and I'll help you think through every detail, research the codebase, and generate comprehensive tasks.</p>
                                    <p>I'll ask questions to understand your vision better and uncover edge cases you might not have considered.</p>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <div class="chat-tools">
                                <button class="tool-btn" data-tool="research" title="Research codebase">
                                    üîç
                                </button>
                                <button class="tool-btn" data-tool="adversarial" title="Adversarial analysis">
                                    ‚öîÔ∏è
                                </button>
                                <button class="tool-btn" data-tool="mindmap" title="View mind map">
                                    üó∫Ô∏è
                                </button>
                            </div>
                            <textarea 
                                id="brainstormInput" 
                                class="brainstorm-input" 
                                placeholder="Describe your idea, feature, or problem to solve..."
                                rows="3"
                            ></textarea>
                            <button id="sendBrainstormBtn" class="btn-primary">Send</button>
                        </div>
                    </div>
                    <div class="brainstorm-tasks">
                        <div class="tasks-header">
                            <h3>Generated Tasks (<span id="taskGenCount">0</span>)</h3>
                            <div class="task-actions">
                                <button id="approveAllBtn" class="btn-secondary" onclick="window.brainstormManager.approveAllTasks()">‚úÖ All</button>
                                <button id="rejectAllBtn" class="btn-secondary" onclick="window.brainstormManager.rejectAllTasks()">‚ùå None</button>
                                <button id="refineTasksBtn" class="btn-secondary">üîÑ Refine</button>
                                <button id="exportTasksBtn" class="btn-primary" disabled>üì§ Export to Kanban</button>
                            </div>
                        </div>
                        <div id="generatedTasks" class="generated-tasks">
                            <!-- Generated tasks will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kanban View -->
        <div id="kanbanView" class="view-container">
        <!-- Mobile View -->
        <div class="mobile-view">
            <div class="task-status" id="currentTaskMobile">
                <h3>Current Task</h3>
                <div class="task-card" id="activeTaskMobile">
                    <p class="empty-state">No active task</p>
                </div>
            </div>
            
            <div class="task-section">
                <div class="section-header">
                    <h3>Ready Queue (<span id="readyCountMobile">0</span>)</h3>
                    <button id="addTaskMobileBtn" class="btn-primary">+ Add Task</button>
                </div>
                <div id="readyTasksMobile" class="task-list"></div>
            </div>
            
            <div class="task-section">
                <h3>Review (<span id="reviewCountMobile">0</span>)</h3>
                <div id="reviewTasksMobile" class="task-list"></div>
            </div>
        </div>

        <!-- Desktop Kanban View -->
        <div class="desktop-view">
            <div class="kanban-board">
                <!-- Backlog Column -->
                <div class="kanban-column" data-status="backlog">
                    <div class="column-header">
                        <h3>Backlog</h3>
                        <span class="task-count" id="backlogCount">0</span>
                    </div>
                    <div class="task-container" id="backlogTasks"></div>
                    <button class="btn-add-task" id="addTaskBtn">+ Add Task</button>
                </div>

                <!-- Ready Column -->
                <div class="kanban-column" data-status="ready">
                    <div class="column-header">
                        <h3>Ready</h3>
                        <span class="task-count" id="readyCount">0</span>
                    </div>
                    <div class="task-container" id="readyTasks"></div>
                </div>

                <!-- Working Column -->
                <div class="kanban-column" data-status="working">
                    <div class="column-header">
                        <h3>Working</h3>
                        <span class="task-count" id="workingCount">0</span>
                    </div>
                    <div class="task-container" id="workingTasks">
                        <div class="active-task" id="activeTask"></div>
                    </div>
                </div>

                <!-- Review Column -->
                <div class="kanban-column" data-status="review">
                    <div class="column-header">
                        <h3>Review</h3>
                        <span class="task-count" id="reviewCount">0</span>
                    </div>
                    <div class="task-container" id="reviewTasks"></div>
                </div>

                <!-- Pushed Column -->
                <div class="kanban-column" data-status="pushed">
                    <div class="column-header">
                        <h3>Pushed</h3>
                        <span class="task-count" id="pushedCount">0</span>
                    </div>
                    <div class="task-container" id="pushedTasks"></div>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Task</h2>
                <button class="modal-close" id="closeTaskModal">&times;</button>
            </div>
            <div class="modal-body">
                <textarea 
                    id="taskDescription" 
                    class="task-input" 
                    placeholder="Describe the task..."
                    rows="4"
                ></textarea>
                <div class="template-buttons">
                    <button class="template-btn" data-template="bug">üêõ Fix Bug</button>
                    <button class="template-btn" data-template="feature">‚ú® Feature</button>
                    <button class="template-btn" data-template="docs">üìù Docs</button>
                    <button class="template-btn" data-template="test">üß™ Tests</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelTaskBtn">Cancel</button>
                <button class="btn-primary" id="saveTaskBtn">Add to Queue</button>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add GitHub Project</h2>
                <button class="modal-close" id="closeProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <input 
                    type="text" 
                    id="projectRepo" 
                    class="input-field" 
                    placeholder="owner/repository (e.g., bhumanai/noderr-auto)"
                >
                <input 
                    type="text" 
                    id="projectBranch" 
                    class="input-field" 
                    placeholder="Branch (default: main)"
                    value="main"
                >
                <input 
                    type="text" 
                    id="projectName" 
                    class="input-field" 
                    placeholder="Display name (optional)"
                >
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelProjectBtn">Cancel</button>
                <button class="btn-primary" id="saveProjectBtn">Add Project</button>
            </div>
        </div>
    </div>

    <!-- Review Task Modal -->
    <div id="reviewTaskModal" class="modal">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h2>Review Task</h2>
                <button class="modal-close" id="closeReviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="review-task-info">
                    <h3 id="reviewTaskTitle"></h3>
                    <p class="task-meta">
                        Duration: <span id="reviewDuration"></span> | 
                        Agent: <span id="reviewAgent"></span>
                    </p>
                </div>
                <div class="review-changes">
                    <h4>Changes:</h4>
                    <pre id="reviewChanges" class="code-block"></pre>
                </div>
                <div class="review-commit">
                    <h4>Commit Message:</h4>
                    <textarea id="commitMessage" class="commit-input" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-warning" id="reviseTaskBtn">‚Ü© Revise</button>
                <button class="btn-success" id="approveTaskBtn">‚úì Approve & Push</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Git Configuration</h3>
                    <label class="toggle-setting">
                        <input type="checkbox" id="autoCommit" checked>
                        <span>Auto-commit after task completion</span>
                    </label>
                    <label class="toggle-setting">
                        <input type="checkbox" id="autoPush" checked>
                        <span>Auto-push to GitHub</span>
                    </label>
                </div>
                <div class="settings-section">
                    <h3>API Configuration</h3>
                    <input 
                        type="password" 
                        id="apiToken" 
                        class="input-field" 
                        placeholder="API Token (optional)"
                    >
                </div>
                <div class="settings-section">
                    <h3>UI Preferences</h3>
                    <label class="toggle-setting">
                        <input type="checkbox" id="soundNotifications">
                        <span>Sound notifications</span>
                    </label>
                    <label class="toggle-setting">
                        <input type="checkbox" id="desktopNotifications">
                        <span>Desktop notifications</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="closeSettings">Close</button>
                <button class="btn-primary" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script src="app.js"></script>
    <script src="brainstorm-engine.js"></script>
    <script src="brainstorm.js"></script>
</body>
</html>